<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="hr_request_overtime_view_tree" model="ir.ui.view">
        <field name="name">hr.request.overtime.tree</field>
        <field name="model">hr.request.overtime</field>
        <field name="arch" type="xml">
            <tree string="Request Overtime" multi_edit="1" sample="1">
                <field name="name"/>
                <field name="project_id"/>
                <field name="user_id"/>
                <field name="member_ids" widget="many2many_avatar_employee"/>
                <field name="request_creator_id" widget="many2one_avatar" optional="hide"/>
                <field name="start_date"/>
                <field name="end_date"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="description"/>
                <field name="stage_id" widget="badge"/>
            </tree>
        </field>
    </record>

    <record id="hr_request_overtime_view_form" model="ir.ui.view">
        <field name="name">hr.request.overtime.view.form</field>
        <field name="model">hr.request.overtime</field>
        <field name="arch" type="xml">
            <form string="Request Overtime - Form" duplicate="0">
                <header>
                    <field name='submit_flag' invisible="1"/>
                    <field name='stage_name' invisible="1"/>
                    <field name='confirm_flag' invisible="1"/>
                    <field name='request_flag' invisible="1"/>
                    <field name='approve_flag' invisible="1"/>
                    <button string="Request" name="action_request_overtime" type="object" class="btn-primary" attrs="{'invisible': ['|', ('request_flag', '!=', True), ('stage_name', '!=', 'Draft')]}"/>
                    <button string="Confirm" groups="hr_timesheet_request_overtime.request_overtime_access_director" name="action_confirm_request_overtime" type="object" class="btn-primary" attrs="{'invisible': ['|', ('confirm_flag', '!=', True), ('stage_name', '!=', 'Request')]}"/>
                    <button string="Submit" groups="hr_timesheet_request_overtime.request_overtime_access_projmanager" name="action_submit_request_overtime" type="object" class="btn-primary" attrs="{'invisible': ['|', ('submit_flag', '!=', True), ('stage_name', '!=', 'Confirm')]}" />
                    <button string="Approval" groups="hr_timesheet_request_overtime.request_overtime_access_director" name="action_approve_request_overtime" type="object" class="btn-primary" attrs="{'invisible': ['|', ('approve_flag', '!=', True), ('stage_name', '!=', 'Submit')]}"/>
                    <button string="Refuse" groups="hr_timesheet_request_overtime.request_overtime_access_projmanager" name="action_refuse_reason" type="object" attrs="{'invisible': [('active', '=', False)]}" data-hotkey="x" />
                    <button string="Restore" groups="hr_timesheet_request_overtime.request_overtime_access_projmanager" name="toggle_active" type="object" attrs="{'invisible': [('active', '=', True)]}" data-hotkey="z"/>
                    <field name="stage_id" widget="statusbar" attrs="{'invisible': [('active', '=', False)], 'readonly':[('active', '=', True)] }"/>
                </header>
                <sheet>
                    <field name='stage_name' invisible="1"/>
                    <field name='active' invisible="1"/>
                    <field name='approve_flag' invisible="1"/>
                    <widget name="web_ribbon" title="REFUSED" bg_color="bg-danger" attrs="{'invisible':[('active', '=', True)]}"/>
                    <widget name="web_ribbon" title="APPROVED" bg_color="bg-success" attrs="{'invisible':[ '|','|', ('approve_flag', '=', True), ('stage_name', '!=', 'Approval'), ('active', '=', False)]}"/>
                    <sheet>
                        <group>
                            <div class="oe_title" style="width: 1500px">
                                <label for="name" class="oe_edit_only"/>
                                <h1>
                                    <field name="name" placeholder="e.g. Request overtime for project ... "/>
                                </h1>
                            </div>
                        </group>
                        <group >
                            <field name="active" invisible="1"/>
                            <group name="group_left">
                                <field name="refuse_reason" attrs="{'invisible': [('active', '=', True)]}"/>
                                <field name="project_id" domain='get_domain_projects' attrs="{'readonly': [('company_id', '=', False)]}"/>
                                <field name="get_domain_projects" invisible="1"/>
                                <label for="start_date" string="Dates" attrs="{'invisible': [('project_id','=',False)]}"/>
                                <div name="end_date" class="o_row">
                                    <field name="start_date_project" widget="daterange" options='{"related_end_date": "end_date"}' attrs="{'invisible': [('project_id','=',False)]}"/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('project_id','=',False)]}"/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('start_date', '=', False), ('end_date', '=', False)]}"/>
                                    <field name="end_date_project" widget="daterange" options='{"related_start_date": "start_date"}' attrs="{'invisible': [('project_id','=',False)]}"/>
                                </div>
                                <field name="user_id" string="Project Manager" widget="many2one_avatar_user" domain="[('share', '=', False)]" width="2" attrs="{'invisible': [('project_id','=',False)]}"/>
                                <field name="company_id" groups="base.group_multi_company"/>
                                <field name="request_creator_id" options="{'no_create_edit': True, 'no_open': True}"/>
                            </group>
                            <group name="group_right">
                                <label for="start_date" string="Plan"/>
                                <div name="end_date" class="o_row">
                                    <field name="start_date" widget="daterange" options='{"related_end_date": "end_date"}'/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_edit_only" aria-label="Arrow icon" title="Arrow"/>
                                    <i class="fa fa-long-arrow-right mx-2 oe_read_only" aria-label="Arrow icon" title="Arrow" attrs="{'invisible': [('start_date', '=', False), ('end_date', '=', False)]}"/>
                                    <field name="end_date" widget="daterange" options='{"related_start_date": "start_date"}'/>
                                </div>
                                <field name="duration_overtime" readonly="1" style="margin-top:10px;"/>
                                <field name="requester_id" readonly="0" widget="many2many_tags"/>
                            </group>
                        </group>
                        <separator string="Description"/>
                        <field name="description" placeholder="Description"/>
                        <group>
                            <field name="member_ids" readonly="1" force_save="1" widget="many2many_avatar_employee"/>
                        </group>
                        <notebook>
                            <page string="Booking Overtime">
                                <field name="booking_overtime" colspan="4" nolabel="1">
                                    <tree string="Assign Members">
                                        <field name="user_id_domain" invisible="1"/>
                                        <field name="read_stage" invisible="1"/>
                                        <field name="inactive" invisible='1'/>
                                        <field name="user_id" widget="many2one_avatar" options="{'no_create': True}" width="1" domain="user_id_domain"/>
                                        <field name="start_date" />
                                        <field name="end_date" />
                                        <field name="duration" string="Duration" width="1"/>
                                        <field name="booking_time_overtime" width="2" required="1"/>
                                        <field name="actual_overtime" width="1"/>
                                        <field name="description"/>
                                        <button name="timesheets_overtime_detail_action" string="More" type="object" class="oe_highlight"/>
                                    </tree>
                                    <form>
                                        <header>
                                        </header>
                                        <sheet>
                                            <div class="oe_title" style="width: 500px">
                                                <h1>
                                                    <field name="user_id_domain" invisible="1"/>
                                                    <field name="user_id" domain="user_id_domain" widget="many2one_avatar" class="o_text_overflow" placeholder="Member Name" options="{'no_create': True}" />
                                                </h1>
                                            </div>
                                            <group col="4">
                                                <field name="start_date" />
                                                <field name="end_date"/>
                                                <field name="booking_time_overtime" placeholder="Hour..." required="1"/>
                                                <field name="actual_overtime" invisible="1"/>
                                            </group>
                                            <separator string="Description"/>
                                            <field name="description" placeholder="Description..."/>
                                        </sheet>
                                    </form>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids" options="{'post_refresh': 'always'}"/>
                </div>
            </form>
        </field>
    </record>


    <!-- Inherit Timesheets task -->
    <record id="view_task_form_timesheet_ot_inhit" model="ir.ui.view">
        <field name="name">view.task.form.timesheet.inhit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="hr_timesheet.view_task_form2_inherited"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='timesheet_ids']/tree/field[@name='employee_id']" position="after">
                <!-- invisible 3 field nay -->
                <field name="request_overtime_ids" optional="hide"/>
                <field name="check_request_ot" optional="hide"/>
                <field name="check_approval_ot" optional="hide"/>
                <field name="status_timesheet_overtime" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='timesheet_ids']/tree/field[@name='type_ot']" position="after">
                <field name="type_day_ot" attrs="{'invisible': [('type_ot', '=', 'no')]}"/>
            </xpath>
            <xpath expr="//field[@name='unit_amount']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='employee_id']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='type_ot']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='type_day_ot']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
        </field>
    </record>

    <!-- inherit Timesheets -->
    <record id="hr_timesheet_line_tree_inhit2" model="ir.ui.view">
        <field name="name">timesheet.line.tree.inhit2</field>
        <field name="model">account.analytic.line</field>
        <field name="inherit_id" ref="hr_timesheet.hr_timesheet_line_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='type_ot']" position="after">
                <field name="type_day_ot" attrs="{'invisible': [('type_ot', '=', 'no')]}"/>
            </xpath>
            <xpath expr="//field[@name='unit_amount']" position="after">
                <field name="pay_type" attrs="{'invisible': [('type_ot', '=', 'no')]}"/>
                <field name="status_timesheet_overtime" string="Status" widget="badge" readonly="1" decoration-info="status_timesheet_overtime == 'draft'" decoration-warning="status_timesheet_overtime in ('refuse')" decoration-success="status_timesheet_overtime == 'confirm'"/>
                <field name="reason_reject" placeholder="Type Reason Refuse Taskscore..." attrs="{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('read_only_reason_refuse', '=', False)]}"/>
                <field name="read_only_reason_refuse" invisible="1"/>
                <button name="approve_timesheet_overtime" string="Confirm" icon="fa-thumbs-up" type="object" attrs="{'invisible': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('read_only_reason_refuse', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="before">
                <!-- invisible 3 field -->
                <field name="request_overtime_ids" optional="hide"/>
                <field name="check_request_ot" optional="hide"/>
                <field name="check_approval_ot" optional="hide"/>
            </xpath>
            <xpath expr="//field[@name='unit_amount']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='employee_id']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='project_id']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='task_id']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='type_ot']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='type_day_ot']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='pay_type']" position="attributes">
                <attribute name="attrs">{'readonly': ['|', ('status_timesheet_overtime', '=', 'confirm'), ('check_request_ot' ,'=', True)]}</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.server" id="action_confirm_all_timesheet_overtime">
        <field name="name">Confirm All</field>
        <field name="model_id" ref="model_account_analytic_line"/>
        <field name="binding_model_id" ref="model_account_analytic_line"/>
        <field name="state">code</field>
        <field name="code">
           action = records.action_confirm_all_timesheet_overtime()
        </field>
    </record>

    <record id="view_request_overtime_search" model="ir.ui.view">
        <field name="name">request.overtime.filter</field>
        <field name="model">hr.request.overtime</field>
        <field name="arch" type="xml">
            <search string="Search Request Overtime">
                <filter string="Request Refuse" name="filter_refuse_request" domain="[('active', '=', False)]"/>
                <separator/>
                <filter string="Approvals" name="filter_approvals_request" domain="[('stage_id.name', '=', 'Approval')]"/>
                <field name="active"/>
                <field name="project_id"/>
                <field name="user_id"/>
                <field name="member_ids"/>
                <field name="stage_id"/>
                <!-- <filter string="Task not Star" name="filter_not_star" domain="[('task_score', '=', '0')]"/> -->
                <group expand="0" string="Group By">
                    <filter string="Project" name="group_by_project" context="{'group_by': 'project_id'}"/>
                    <filter string="Stage" name="group_by_stage" context="{'group_by': 'stage_id'}" />
                </group>
            </search>
        </field>
    </record>

</odoo>